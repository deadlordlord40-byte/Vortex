<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LuxeVault | Premium Store</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        :root {
            --gold: #FFD700;
            --black: #0F0F0F;
            --white: #FFFFFF;
            --gray: #1A1A1A;
            --red: #FF3B30;
            --green: #34C759;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', sans-serif;
        }
        
        body {
            background: var(--black);
            color: var(--white);
            min-height: 100vh;
        }
        
        /* HEADER */
        .header {
            background: #111;
            padding: 15px 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 3px solid var(--gold);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }
        
        .logo i {
            font-size: 28px;
            color: var(--gold);
        }
        
        .logo h1 {
            font-size: 24px;
            background: linear-gradient(to right, var(--gold), #FFED4E);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 800;
        }
        
        /* USER INFO */
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, var(--gold), #FFED4E);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: black;
            overflow: hidden;
        }
        
        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* BUTTONS */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: 0.3s;
        }
        
        .btn-primary {
            background: var(--gold);
            color: black;
        }
        
        .btn-primary:hover {
            background: #FFED4E;
        }
        
        /* PRODUCTS */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            padding: 30px 5%;
        }
        
        .product-card {
            background: #1E1E1E;
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid #333;
            transition: 0.3s;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            border-color: var(--gold);
        }
        
        .product-img {
            width: 100%;
            height: 180px;
            object-fit: cover;
        }
        
        .product-info {
            padding: 15px;
        }
        
        .product-title {
            font-size: 18px;
            margin-bottom: 5px;
            color: white;
        }
        
        .product-price {
            font-size: 22px;
            font-weight: bold;
            color: var(--gold);
            margin: 10px 0;
        }
        
        /* CART */
        .cart-btn {
            position: relative;
            font-size: 24px;
            color: var(--gold);
            cursor: pointer;
        }
        
        .cart-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--red);
            color: white;
            font-size: 12px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        /* MODAL */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: #222;
            padding: 30px;
            border-radius: 10px;
            border: 2px solid var(--gold);
            max-width: 400px;
            width: 90%;
            text-align: center;
        }
        
        .google-btn {
            background: white;
            color: #444;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            margin-top: 20px;
        }
        
        .google-btn:hover {
            background: #f5f5f5;
        }
        
        /* ORDERS */
        .orders-container {
            padding: 20px 5%;
        }
        
        .order-card {
            background: #1E1E1E;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid var(--gold);
        }
    </style>
</head>
<body>
    <!-- HEADER -->
    <div class="header">
        <div class="logo" onclick="showHome()">
            <i class="fas fa-gem"></i>
            <h1>LuxeVault</h1>
        </div>
        
        <div class="user-info">
            <div id="userDisplay" style="display: none;">
                <div class="user-avatar" id="userAvatar">U</div>
                <span id="userName">User</span>
            </div>
            
            <div class="cart-btn" onclick="openCart()">
                <i class="fas fa-shopping-cart"></i>
                <div class="cart-count">0</div>
            </div>
            
            <button class="btn btn-primary" onclick="toggleLogin()" id="loginBtn">
                <i class="fas fa-sign-in-alt"></i> Login
            </button>
        </div>
    </div>
    
    <!-- HOME -->
    <div id="homePage">
        <div style="text-align: center; padding: 50px 5%;">
            <h1 style="font-size: 48px; margin-bottom: 20px; color: var(--gold);">Welcome to LuxeVault</h1>
            <p style="font-size: 18px; color: #ccc; max-width: 600px; margin: 0 auto 30px;">
                Premium products for everyone. Login with Google to start shopping.
            </p>
            <button class="btn btn-primary" onclick="showProducts()" style="padding: 15px 30px; font-size: 18px;">
                <i class="fas fa-shopping-bag"></i> Start Shopping
            </button>
        </div>
    </div>
    
    <!-- PRODUCTS -->
    <div id="productsPage" style="display: none;">
        <div class="products-grid" id="productsGrid">
            <!-- Products load here -->
        </div>
    </div>
    
    <!-- ORDERS -->
    <div id="ordersPage" style="display: none;">
        <div class="orders-container">
            <h2 style="color: var(--gold); margin-bottom: 20px;">My Orders</h2>
            <div id="ordersList">
                <p style="text-align: center; color: #888; padding: 40px;">Login to see your orders</p>
            </div>
        </div>
    </div>
    
    <!-- CART MODAL -->
    <div class="modal" id="cartModal">
        <div class="modal-content">
            <h2 style="color: var(--gold); margin-bottom: 20px;">Your Cart</h2>
            <div id="cartItems"></div>
            <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #444;">
                <div style="display: flex; justify-content: space-between; font-size: 20px; font-weight: bold;">
                    <span>Total:</span>
                    <span id="cartTotal">₹0</span>
                </div>
                <button class="btn btn-primary" onclick="checkout()" style="width: 100%; margin-top: 20px;">
                    <i class="fas fa-credit-card"></i> Checkout
                </button>
            </div>
            <button class="btn" onclick="closeCart()" style="width: 100%; margin-top: 10px; background: #444; color: white;">
                Close
            </button>
        </div>
    </div>
    
    <!-- LOGIN MODAL -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <h2 style="color: var(--gold); margin-bottom: 10px;">Welcome!</h2>
            <p style="color: #888; margin-bottom: 30px;">Login with Google to shop</p>
            <button class="google-btn" onclick="googleLogin()">
                <i class="fab fa-google" style="color: #DB4437;"></i>
                Sign in with Google
            </button>
            <p style="margin-top: 20px; color: #666; font-size: 14px;">
                Your order history will be saved
            </p>
        </div>
    </div>
    
    <!-- CHECKOUT MODAL -->
    <div class="modal" id="checkoutModal" style="display: none;">
        <div class="modal-content">
            <h2 style="color: var(--gold); margin-bottom: 20px;">Checkout</h2>
            <div style="text-align: left;">
                <div style="margin-bottom: 15px;">
                    <label style="display: block; color: #ccc; margin-bottom: 5px;">Name</label>
                    <input type="text" id="checkoutName" style="width: 100%; padding: 10px; background: #333; border: 1px solid #444; color: white; border-radius: 5px;">
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; color: #ccc; margin-bottom: 5px;">Phone</label>
                    <input type="tel" id="checkoutPhone" style="width: 100%; padding: 10px; background: #333; border: 1px solid #444; color: white; border-radius: 5px;">
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="display: block; color: #ccc; margin-bottom: 5px;">Address</label>
                    <textarea id="checkoutAddress" rows="3" style="width: 100%; padding: 10px; background: #333; border: 1px solid #444; color: white; border-radius: 5px;"></textarea>
                </div>
                <button class="btn btn-primary" onclick="placeOrder()" style="width: 100%;">
                    <i class="fas fa-check"></i> Confirm Order
                </button>
            </div>
        </div>
    </div>

    <script>
        // FIREBASE CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyDUULcvF_0yELjEjyivwNYYV4ibDUlTusk",
            authDomain: "luxevault-ecommerce.firebaseapp.com",
            projectId: "luxevault-ecommerce",
            storageBucket: "luxevault-ecommerce.firebasestorage.app",
            messagingSenderId: "58258297089",
            appId: "1:58258297089:web:cfa48acebc33e88ca5cb00"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        let currentUser = null;
        let cart = [];
        let products = [];

        // CHECK LOGIN STATUS
        auth.onAuthStateChanged(user => {
            if (user) {
                currentUser = {
                    uid: user.uid,
                    name: user.displayName,
                    email: user.email,
                    photoURL: user.photoURL
                };
                updateUserDisplay();
                loadProducts();
                loadOrders();
                
                // Save user to database
                db.collection('users').doc(user.uid).set({
                    name: user.displayName,
                    email: user.email,
                    lastLogin: new Date().toISOString()
                }, { merge: true });
                
            } else {
                currentUser = null;
                updateUserDisplay();
            }
        });

        // GOOGLE LOGIN
        function googleLogin() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider)
                .then(() => {
                    alert('✅ Login successful!');
                    closeLoginModal();
                })
                .catch(error => {
                    alert('❌ Login failed: ' + error.message);
                });
        }

        // LOGOUT
        function logout() {
            auth.signOut();
            alert('Logged out');
        }

        // UPDATE USER DISPLAY
        function updateUserDisplay() {
            if (currentUser) {
                document.getElementById('userDisplay').style.display = 'flex';
                document.getElementById('userName').textContent = currentUser.name;
                document.getElementById('userAvatar').innerHTML = currentUser.photoURL ? 
                    `<img src="${currentUser.photoURL}" alt="${currentUser.name}">` :
                    `<span>${currentUser.name.charAt(0)}</span>`;
                document.getElementById('loginBtn').innerHTML = '<i class="fas fa-sign-out-alt"></i> Logout';
                document.getElementById('loginBtn').onclick = logout;
            } else {
                document.getElementById('userDisplay').style.display = 'none';
                document.getElementById('loginBtn').innerHTML = '<i class="fas fa-sign-in-alt"></i> Login';
                document.getElementById('loginBtn').onclick = toggleLogin;
            }
        }

        // LOAD PRODUCTS
        async function loadProducts() {
            try {
                const snapshot = await db.collection('products').get();
                products = [];
                snapshot.forEach(doc => {
                    products.push({ id: doc.id, ...doc.data() });
                });
                
                // If no products, add some defaults
                if (products.length === 0) {
                    products = [
                        {
                            id: "1",
                            name: "Golden Watch",
                            description: "Luxury wrist watch",
                            price: 12999,
                            image: "https://images.unsplash.com/photo-1523170335258-f5ed11844a49?w=600"
                        },
                        {
                            id: "2",
                            name: "Leather Wallet",
                            description: "Premium leather wallet",
                            price: 2999,
                            image: "https://images.unsplash.com/photo-1620799140408-edc6dcb6d633?w-600"
                        }
                    ];
                }
                
                displayProducts();
            } catch (error) {
                console.error("Error loading products:", error);
            }
        }

        // DISPLAY PRODUCTS
        function displayProducts() {
            const container = document.getElementById('productsGrid');
            container.innerHTML = '';
            
            products.forEach(product => {
                const card = document.createElement('div');
                card.className = 'product-card';
                card.innerHTML = `
                    <img src="${product.image}" class="product-img" alt="${product.name}">
                    <div class="product-info">
                        <h3 class="product-title">${product.name}</h3>
                        <p style="color: #aaa; font-size: 14px; margin-bottom: 10px;">${product.description}</p>
                        <div class="product-price">₹${product.price.toLocaleString()}</div>
                        <button class="btn btn-primary" onclick="addToCart('${product.id}')" style="width: 100%;">
                            <i class="fas fa-cart-plus"></i> Add to Cart
                        </button>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // CART FUNCTIONS
        function addToCart(productId) {
            if (!currentUser) {
                alert('Please login first');
                toggleLogin();
                return;
            }
            
            const product = products.find(p => p.id === productId);
            if (product) {
                cart.push(product);
                updateCartCount();
                alert('Added to cart: ' + product.name);
            }
        }

        function updateCartCount() {
            document.querySelector('.cart-count').textContent = cart.length;
        }

        function openCart() {
            const container = document.getElementById('cartItems');
            if (cart.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #888;">Your cart is empty</p>';
                document.getElementById('cartTotal').textContent = '₹0';
            } else {
                let html = '';
                let total = 0;
                
                cart.forEach((item, index) => {
                    total += item.price;
                    html += `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #333;">
                            <div>
                                <div>${item.name}</div>
                                <div style="color: var(--gold);">₹${item.price.toLocaleString()}</div>
                            </div>
                            <button onclick="removeFromCart(${index})" style="background: var(--red); color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
                document.getElementById('cartTotal').textContent = '₹' + total.toLocaleString();
            }
            
            document.getElementById('cartModal').style.display = 'flex';
        }

        function removeFromCart(index) {
            cart.splice(index, 1);
            updateCartCount();
            openCart();
        }

        function closeCart() {
            document.getElementById('cartModal').style.display = 'none';
        }

        // CHECKOUT
        function checkout() {
            if (cart.length === 0) {
                alert('Your cart is empty');
                return;
            }
            
            document.getElementById('checkoutModal').style.display = 'flex';
            document.getElementById('cartModal').style.display = 'none';
        }

        // PLACE ORDER
        async function placeOrder() {
            const name = document.getElementById('checkoutName').value;
            const phone = document.getElementById('checkoutPhone').value;
            const address = document.getElementById('checkoutAddress').value;
            
            if (!name || !phone || !address) {
                alert('Please fill all details');
                return;
            }
            
            try {
                const orderId = 'ORD' + Date.now();
                const total = cart.reduce((sum, item) => sum + item.price, 0);
                
                await db.collection('orders').doc(orderId).set({
                    id: orderId,
                    userId: currentUser.uid,
                    userName: name,
                    userEmail: currentUser.email,
                    userPhone: phone,
                    address: address,
                    items: cart,
                    total: total,
                    status: 'Pending',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Clear cart
                cart = [];
                updateCartCount();
                
                // Close modals
                document.getElementById('checkoutModal').style.display = 'none';
                document.getElementById('cartModal').style.display = 'none';
                
                alert(`✅ Order #${orderId} placed successfully!`);
                showOrders();
                
            } catch (error) {
                alert('❌ Error placing order: ' + error.message);
            }
        }

        // LOAD ORDERS
        async function loadOrders() {
            if (!currentUser) return;
            
            const container = document.getElementById('ordersList');
            container.innerHTML = '<p>Loading orders...</p>';
            
            try {
                const snapshot = await db.collection('orders')
                    .where('userId', '==', currentUser.uid)
                    .orderBy('createdAt', 'desc')
                    .get();
                
                if (snapshot.empty) {
                    container.innerHTML = '<p style="text-align: center; color: #888;">No orders yet</p>';
                    return;
                }
                
                container.innerHTML = '';
                snapshot.forEach(doc => {
                    const order = doc.data();
                    const date = order.createdAt?.toDate ? order.createdAt.toDate().toLocaleDateString() : '';
                    
                    const card = document.createElement('div');
                    card.className = 'order-card';
                    card.innerHTML = `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <div>
                                <strong style="color: var(--gold);">Order #${order.id}</strong><br>
                                <small style="color: #888;">${date}</small>
                            </div>
                            <span style="background: ${order.status === 'Delivered' ? 'var(--green)' : '#FFA500'}; color: ${order.status === 'Delivered' ? 'white' : 'black'}; padding: 5px 10px; border-radius: 4px; font-size: 12px;">
                                ${order.status}
                            </span>
                        </div>
                        <div style="margin: 10px 0;">
                            ${order.items.map(item => `<div>${item.name} - ₹${item.price}</div>`).join('')}
                        </div>
                        <div style="font-weight: bold; color: var(--gold);">
                            Total: ₹${order.total}
                        </div>
                    `;
                    container.appendChild(card);
                });
            } catch (error) {
                container.innerHTML = '<p style="text-align: center; color: #888;">Error loading orders</p>';
            }
        }

        // PAGE NAVIGATION
        function showHome() {
            document.getElementById('homePage').style.display = 'block';
            document.getElementById('productsPage').style.display = 'none';
            document.getElementById('ordersPage').style.display = 'none';
        }
        
        function showProducts() {
            document.getElementById('homePage').style.display = 'none';
            document.getElementById('productsPage').style.display = 'block';
            document.getElementById('ordersPage').style.display = 'none';
            loadProducts();
        }
        
        function showOrders() {
            document.getElementById('homePage').style.display = 'none';
            document.getElementById('productsPage').style.display = 'none';
            document.getElementById('ordersPage').style.display = 'block';
            loadOrders();
        }
        
        // LOGIN MODAL
        function toggleLogin() {
            document.getElementById('loginModal').style.display = 'flex';
        }
        
        function closeLoginModal() {
            document.getElementById('loginModal').style.display = 'none';
        }
        
        // INITIALIZE
        document.addEventListener('DOMContentLoaded', function() {
            showHome();
            loadProducts();
            
            // Close modals when clicking outside
            window.onclick = function(event) {
                if (event.target.className === 'modal') {
                    event.target.style.display = 'none';
                }
            };
        });
    </script>
</body>
</html>
